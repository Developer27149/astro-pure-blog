---
import TimeAgo from "@components/TimeAgo";
import { calcRelativeDate } from "@utils/formatDate";
import type { CollectionEntry } from "astro:content";
import { format } from "date-fns";
import { slug as ghSlug } from "github-slugger";
export interface Props {
  posts: CollectionEntry<"blog">[];
}

const { posts } = Astro.props;
---

<main>
  <h1
    class="inline-block py-24 text-2xl font-semibold origin-center hover:scale-105 transition-all"
  >
    BLOG
  </h1>
  <ul>
    {
      posts.map(({ slug, data }, idx) => (
        <li
          class="group flex items-center gap-12 md:gap-8 py-2 animate-fade-left mb-2"
          style={`animation-delay:${idx * 70}ms`}
          transition:name={ghSlug(slug)}
        >
          <span class="hidden md:inline-block rounded-sm p-[2px] px-[4px] text-sm min-w-[100px]">
            {calcRelativeDate(data.modDatetime ?? data.pubDatetime)}
          </span>
          <span class="md:hidden inline-block rounded-sm p-[2px] px-[4px] skew-x-6">
            {format(new Date(data.modDatetime ?? data.pubDatetime), "yyyy/MM")}
          </span>
          <a
            class="group-hover:underline underline-offset-4 font-thin decoration-sky-200 transition-all cursor-pointer dark:text-teal-300"
            style=""
            href={`/posts/${slug}`}
            data-description={data.description}
          >
            {slug}
          </a>
        </li>
      ))
    }
  </ul>
</main>
<div
  id="description-elem"
  class="absolute z-[999] bg-gray-900 text-white dark:bg-gray-50 p-2 rounded-sm shadow dark:text-teal-400"
>
</div>

<script is:inline>
  const posts = document.querySelectorAll("main li:has(a[data-description])");
  const descriptionElem = document.getElementById("description-elem");
  posts.forEach((post) => {
    const link = post.querySelector("a[data-description]");
    post.addEventListener("mouseenter", () => {
      const description = link.getAttribute("data-description");
      // get mouse position
      const { x, y } = link.getBoundingClientRect();
      console.log(description);
      descriptionElem.innerHTML = description;
      descriptionElem.style.left = `${x}px`;
      descriptionElem.style.top = `${y - 40}px`;
      descriptionElem.classList.remove("hidden");
    });
    post.addEventListener("mousemove", () => {
      const description = link.getAttribute("data-description");
      const { x, y } = link.getBoundingClientRect();
      console.log(description);
      descriptionElem.innerHTML = description;
      descriptionElem.style.left = `${x}px`;
      descriptionElem.style.top = `${y - 40}px`;
    });
    post.addEventListener("mouseleave", () => {
      descriptionElem.innerHTML = "";
      descriptionElem.classList.add("hidden");
    });
  });
</script>
